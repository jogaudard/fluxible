<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Practical example: from raw gas concentration data to clean ecosystem gas fluxes. • fluxible</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Practical example: from raw gas concentration data to clean ecosystem gas fluxes.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fluxible</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fluxible_practical_example.html">Practical example: from raw gas concentration data to clean ecosystem gas fluxes.</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Practical example: from raw gas concentration data to clean ecosystem gas fluxes.</h1>
            
      

      <div class="d-none name"><code>fluxible_practical_example.Rmd</code></div>
    </div>

    
    
<p>For this example we will use the data that were recorded during the
Plant Functional Traits Course 6 (PFTC6) in Norway in 2022 at the site
called Liahovden. <!-- (CITE when data paper out). --> The
CO<sub>2</sub> concentration data as well as air and soil temperature
and photosynthetically active radiations (PAR) were recorded in a
dataframe named <code>co2_liahovden</code>. The metadata for each
measurements are in a dataframe called <code>record_liahovden</code>.
This dataframe contains the starting time of each measurements, the type
of measurement and the unique ID for each turf. The type of measurement
describes if it was net ecosystem exchange (NEE), measured with a
transparent chamber, or ecosystem respiration (ER), measured with a dark
chamber.</p>
<p>We use the <code>flux_match</code> function to slice the data from
<code>co2_liahovden</code> into each measurement and discard what was
recorded in between.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=fluxible" class="external-link">fluxible</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">record_liahovden</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [138 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ turfID: chr [1:138] "4 AN1C 4" "4 AN1C 4" "27 AN3C 27" "27 AN3C 27" ...</span></span>
<span><span class="co">#&gt;  $ type  : chr [1:138] "NEE" "ER" "NEE" "ER" ...</span></span>
<span><span class="co">#&gt;  $ start : POSIXct[1:138], format: "2022-07-27 05:37:30" "2022-07-27 05:42:00" ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">co2_liahovden</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [89,692 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ datetime : POSIXct[1:89692], format: "2022-07-27 05:34:49" "2022-07-27 05:34:50" ...</span></span>
<span><span class="co">#&gt;  $ temp_air : num [1:89692] 3 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_soil: num [1:89692] 2.96 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ conc     : num [1:89692] 468 469 468 468 468 ...</span></span>
<span><span class="co">#&gt;  $ PAR      : num [1:89692] 2.59 NA NA NA NA NA NA NA NA NA ...</span></span>
<span></span>
<span><span class="va">conc_liahovden</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_match.html">flux_match</a></span><span class="op">(</span></span>
<span>  raw_conc <span class="op">=</span> <span class="va">co2_liahovden</span>,</span>
<span>  field_record <span class="op">=</span> <span class="va">record_liahovden</span>,</span>
<span>  startcrop <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  measurement_length <span class="op">=</span> <span class="fl">220</span>,</span>
<span>  ratio_threshold <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  time_diff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  datetime_col <span class="op">=</span> <span class="st">"datetime"</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"conc"</span>,</span>
<span>  start_col <span class="op">=</span> <span class="st">"start"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># this exemple does not have a campaign column to pair the measurements</span></span>
<span><span class="co"># we add pairID to pair NEE and ER for GEP calculation later</span></span>
<span><span class="va">conc_liahovden</span> <span class="op">&lt;-</span> <span class="va">conc_liahovden</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    f_fluxID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">f_fluxID</span><span class="op">)</span>,</span>
<span>    pairID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">type</span> <span class="op">==</span> <span class="st">"NEE"</span> <span class="op">~</span> <span class="va">f_fluxID</span>,</span>
<span>      <span class="va">type</span> <span class="op">==</span> <span class="st">"ER"</span> <span class="op">~</span> <span class="va">f_fluxID</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    f_fluxID <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">f_fluxID</span><span class="op">)</span>,</span>
<span>    pairID <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">pairID</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">conc_liahovden</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 14] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime  : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air    : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil   : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc      : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR         : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID      : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type        : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start     : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end       : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID    : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc    : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio     : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match: chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID      : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<p>Before calculating fluxes we need to fit a model to each measurement
and estimate a slope of the concentration changing rate. We use the
<code>flux_fitting</code> function with the model provided by <span class="citation">Zhao <em>et al.</em> (2018)</span>. The function
<code>flux_fitting</code> also provides a quadratic and a linear
fit.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes_exp_liahovden</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_fitting.html">flux_fitting</a></span><span class="op">(</span></span>
<span>  conc_df <span class="op">=</span> <span class="va">conc_liahovden</span>,</span>
<span>  start_cut <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  end_cut <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  start_col <span class="op">=</span> <span class="st">"f_start"</span>,</span>
<span>  end_col <span class="op">=</span> <span class="st">"f_end"</span>,</span>
<span>  datetime_col <span class="op">=</span> <span class="st">"f_datetime"</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"f_conc"</span>,</span>
<span>  fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>  t_window <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  cz_window <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  b_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  a_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  roll_width <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  t_zero <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fit_type <span class="op">=</span> <span class="st">"exponential"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Cutting measurements...</span></span>
<span><span class="co">#&gt; Estimating starting parameters for optimization...</span></span>
<span><span class="co">#&gt; Optimizing fitting parameters...</span></span>
<span><span class="co">#&gt; Calculating fits and slopes...</span></span>
<span><span class="co">#&gt; Done.</span></span>
<span><span class="co">#&gt; Warning in flux_fitting_exp(conc_df, start_cut = ((start_cut)), end_cut = ((end_cut)), : </span></span>
<span><span class="co">#&gt;  fluxID 77 : slope was estimated on 194 points out of 220 seconds</span></span>
<span><span class="co">#&gt;  fluxID 81 : slope was estimated on 217 points out of 220 seconds</span></span>
<span><span class="co">#&gt;  fluxID 83 : slope was estimated on 215 points out of 220 seconds</span></span>
<span><span class="co">#&gt;  fluxID 85 : slope was estimated on 175 points out of 220 seconds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">slopes_exp_liahovden</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 31] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime  : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air    : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil   : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc      : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR         : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID      : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type        : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start     : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end       : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID    : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc    : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio     : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match: chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID      : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_time      : num [1:30281] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ f_cut       : Factor w/ 1 level "keep": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ n_conc      : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ Cm_est      : num [1:30281] 435 435 435 435 435 ...</span></span>
<span><span class="co">#&gt;  $ a_est       : num [1:30281] -0.249 -0.249 -0.249 -0.249 -0.249 ...</span></span>
<span><span class="co">#&gt;  $ b_est       : num [1:30281] -0.00288 -0.00288 -0.00288 -0.00288 -0.00288 ...</span></span>
<span><span class="co">#&gt;  $ tz_est      : num [1:30281] 14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ f_Cz        : num [1:30281] 467 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ time_diff   : num [1:30281] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ f_Cm        : num [1:30281] 372 372 372 372 372 ...</span></span>
<span><span class="co">#&gt;  $ f_a         : num [1:30281] -0.402 -0.402 -0.402 -0.402 -0.402 ...</span></span>
<span><span class="co">#&gt;  $ f_b         : num [1:30281] -0.00229 -0.00229 -0.00229 -0.00229 -0.00229 ...</span></span>
<span><span class="co">#&gt;  $ f_tz        : num [1:30281] 13.2 13.2 13.2 13.2 13.2 ...</span></span>
<span><span class="co">#&gt;  $ f_slope     : num [1:30281] -0.184 -0.184 -0.184 -0.184 -0.184 ...</span></span>
<span><span class="co">#&gt;  $ f_fit       : num [1:30281] 470 470 470 469 469 ...</span></span>
<span><span class="co">#&gt;  $ f_fit_slope : num [1:30281] 470 470 470 469 469 ...</span></span>
<span><span class="co">#&gt;  $ f_start_z   : POSIXct[1:30281], format: "2022-07-27 05:37:43" "2022-07-27 05:37:43" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "fit_type")= chr "exponential"</span></span>
<span></span>
<span><span class="va">slopes_qua_liahovden</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_fitting.html">flux_fitting</a></span><span class="op">(</span></span>
<span>  conc_df <span class="op">=</span> <span class="va">conc_liahovden</span>,</span>
<span>  start_cut <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  end_cut <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  start_col <span class="op">=</span> <span class="st">"f_start"</span>,</span>
<span>  end_col <span class="op">=</span> <span class="st">"f_end"</span>,</span>
<span>  datetime_col <span class="op">=</span> <span class="st">"f_datetime"</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"f_conc"</span>,</span>
<span>  fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>  t_window <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  cz_window <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  b_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  a_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  roll_width <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  t_zero <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  fit_type <span class="op">=</span> <span class="st">"quadratic"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in flux_fitting_quadratic(conc_df, start_cut = ((start_cut)), end_cut = ((end_cut)), : </span></span>
<span><span class="co">#&gt;  fluxID 77 : slope was estimated on 194 points out of 220 seconds because data are missing</span></span>
<span><span class="co">#&gt;  fluxID 81 : slope was estimated on 217 points out of 220 seconds because data are missing</span></span>
<span><span class="co">#&gt;  fluxID 83 : slope was estimated on 215 points out of 220 seconds because data are missing</span></span>
<span><span class="co">#&gt;  fluxID 85 : slope was estimated on 175 points out of 220 seconds because data are missing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">slopes_qua_liahovden</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 26] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime    : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air      : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc        : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start       : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end         : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc      : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio       : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match  : chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_time        : num [1:30281] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ f_cut         : Factor w/ 1 level "keep": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ n_conc        : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_rsquared    : num [1:30281] 0.967 0.967 0.967 0.967 0.967 ...</span></span>
<span><span class="co">#&gt;  $ f_adj_rsquared: num [1:30281] 0.966 0.966 0.966 0.966 0.966 ...</span></span>
<span><span class="co">#&gt;  $ f_pvalue      : Named num [1:30281] 9.07e-161 9.07e-161 9.07e-161 9.07e-161 9.07e-161 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:30281] "value" "value" "value" "value" ...</span></span>
<span><span class="co">#&gt;  $ f_intercept   : num [1:30281] 465 465 465 465 465 ...</span></span>
<span><span class="co">#&gt;  $ f_param1      : num [1:30281] -0.11 -0.11 -0.11 -0.11 -0.11 ...</span></span>
<span><span class="co">#&gt;  $ f_param2      : num [1:30281] 3.9e-06 3.9e-06 3.9e-06 3.9e-06 3.9e-06 ...</span></span>
<span><span class="co">#&gt;  $ f_slope       : num [1:30281] -0.11 -0.11 -0.11 -0.11 -0.11 ...</span></span>
<span><span class="co">#&gt;  $ f_fit         : num [1:30281] 465 465 464 464 464 ...</span></span>
<span><span class="co">#&gt;  $ f_fit_slope   : num [1:30281] 465 465 464 464 464 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "fit_type")= chr "quadratic"</span></span>
<span></span>
<span><span class="va">slopes_lin_liahovden</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_fitting.html">flux_fitting</a></span><span class="op">(</span></span>
<span>  conc_df <span class="op">=</span> <span class="va">conc_liahovden</span>,</span>
<span>  start_cut <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  end_cut <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  start_col <span class="op">=</span> <span class="st">"f_start"</span>,</span>
<span>  end_col <span class="op">=</span> <span class="st">"f_end"</span>,</span>
<span>  datetime_col <span class="op">=</span> <span class="st">"f_datetime"</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"f_conc"</span>,</span>
<span>  fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>  t_window <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  cz_window <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  b_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  a_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  roll_width <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  t_zero <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  fit_type <span class="op">=</span> <span class="st">"linear"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in flux_fitting_lin(conc_df, start_cut = ((start_cut)), end_cut = ((end_cut)), : </span></span>
<span><span class="co">#&gt;  fluxID 77 : slope was estimated on 194 points out of 220 seconds</span></span>
<span><span class="co">#&gt;  fluxID 81 : slope was estimated on 217 points out of 220 seconds</span></span>
<span><span class="co">#&gt;  fluxID 83 : slope was estimated on 215 points out of 220 seconds</span></span>
<span><span class="co">#&gt;  fluxID 85 : slope was estimated on 175 points out of 220 seconds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">slopes_lin_liahovden</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 23] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime    : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air      : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc        : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start       : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end         : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc      : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio       : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match  : chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_time        : num [1:30281] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ f_cut         : Factor w/ 1 level "keep": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ n_conc        : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_rsquared    : num [1:30281] 0.967 0.967 0.967 0.967 0.967 ...</span></span>
<span><span class="co">#&gt;  $ f_adj_rsquared: num [1:30281] 0.966 0.966 0.966 0.966 0.966 ...</span></span>
<span><span class="co">#&gt;  $ f_pvalue      : Named num [1:30281] 9.23e-163 9.23e-163 9.23e-163 9.23e-163 9.23e-163 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:30281] "value" "value" "value" "value" ...</span></span>
<span><span class="co">#&gt;  $ f_intercept   : num [1:30281] 465 465 465 465 465 ...</span></span>
<span><span class="co">#&gt;  $ f_slope       : num [1:30281] -0.109 -0.109 -0.109 -0.109 -0.109 ...</span></span>
<span><span class="co">#&gt;  $ f_fit         : num [1:30281] 465 465 464 464 464 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "fit_type")= chr "linear"</span></span></code></pre></div>
<p>The function <code>flux_quality</code> is used to provide diagnostics
about the quality of the fit, eventually advising to discard some
measurements or replace them by zero.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes_exp_liahovden_flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_quality.html">flux_quality</a></span><span class="op">(</span></span>
<span>  slopes_df <span class="op">=</span> <span class="va">slopes_exp_liahovden</span>,</span>
<span>  <span class="co"># fit_type is automatically provided as an attribute because</span></span>
<span>  <span class="co"># slopes_exp_liahovden was produced with flux_fitting</span></span>
<span>  ambient_conc <span class="op">=</span> <span class="fl">421</span>,</span>
<span>  error <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>  slope_col <span class="op">=</span> <span class="st">"f_slope"</span>,</span>
<span>  force_discard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  force_ok <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ratio_threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"f_conc"</span>,</span>
<span>  b_col <span class="op">=</span> <span class="st">"f_b"</span>,</span>
<span>  time_col <span class="op">=</span> <span class="st">"f_time"</span>,</span>
<span>  fit_col <span class="op">=</span> <span class="st">"f_fit"</span>,</span>
<span>  cut_col <span class="op">=</span> <span class="st">"f_cut"</span>,</span>
<span>  rmse_threshold <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  cor_threshold <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  b_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cut_arg <span class="op">=</span> <span class="st">"cut"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total number of measurements: 138</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  discard      4   3 %</span></span>
<span><span class="co">#&gt;  ok   130     94 %</span></span>
<span><span class="co">#&gt;  zero     4   3 %</span></span>
<span><span class="co">#&gt;  weird_flux   0   0 %</span></span>
<span><span class="co">#&gt;  start_error      0   0 %</span></span>
<span><span class="co">#&gt;  no_data      0   0 %</span></span>
<span><span class="co">#&gt;  force_ok     0   0 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">slopes_exp_liahovden_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 39] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime    : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air      : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc        : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start       : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end         : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc      : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio       : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match  : chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_time        : num [1:30281] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ f_cut         : Factor w/ 1 level "keep": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ n_conc        : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ Cm_est        : num [1:30281] 435 435 435 435 435 ...</span></span>
<span><span class="co">#&gt;  $ a_est         : num [1:30281] -0.249 -0.249 -0.249 -0.249 -0.249 ...</span></span>
<span><span class="co">#&gt;  $ b_est         : num [1:30281] -0.00288 -0.00288 -0.00288 -0.00288 -0.00288 ...</span></span>
<span><span class="co">#&gt;  $ tz_est        : num [1:30281] 14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ f_Cz          : num [1:30281] 467 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ time_diff     : num [1:30281] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ f_Cm          : num [1:30281] 372 372 372 372 372 ...</span></span>
<span><span class="co">#&gt;  $ f_a           : num [1:30281] -0.402 -0.402 -0.402 -0.402 -0.402 ...</span></span>
<span><span class="co">#&gt;  $ f_b           : num [1:30281] -0.00229 -0.00229 -0.00229 -0.00229 -0.00229 ...</span></span>
<span><span class="co">#&gt;  $ f_tz          : num [1:30281] 13.2 13.2 13.2 13.2 13.2 ...</span></span>
<span><span class="co">#&gt;  $ f_slope       : num [1:30281] -0.184 -0.184 -0.184 -0.184 -0.184 ...</span></span>
<span><span class="co">#&gt;  $ f_fit         : num [1:30281] 470 470 470 469 469 ...</span></span>
<span><span class="co">#&gt;  $ f_fit_slope   : num [1:30281] 470 470 470 469 469 ...</span></span>
<span><span class="co">#&gt;  $ f_start_z     : POSIXct[1:30281], format: "2022-07-27 05:37:43" "2022-07-27 05:37:43" ...</span></span>
<span><span class="co">#&gt;  $ f_flag_ratio  : chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_start_error : chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_cor_coef    : num [1:30281] -0.983 -0.983 -0.983 -0.983 -0.983 ...</span></span>
<span><span class="co">#&gt;  $ f_RMSE        : num [1:30281] 2.25 2.25 2.25 2.25 2.25 ...</span></span>
<span><span class="co">#&gt;  $ f_fit_quality : chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ f_correlation : chr [1:30281] "yes" "yes" "yes" "yes" ...</span></span>
<span><span class="co">#&gt;  $ f_quality_flag: chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_slope_corr  : num [1:30281] -0.184 -0.184 -0.184 -0.184 -0.184 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "fit_type")= chr "exponential"</span></span>
<span></span>
<span><span class="va">slopes_qua_liahovden_flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_quality.html">flux_quality</a></span><span class="op">(</span></span>
<span>  slopes_df <span class="op">=</span> <span class="va">slopes_qua_liahovden</span>,</span>
<span>  <span class="co"># fit_type is automatically provided as an attribute because</span></span>
<span>  <span class="co"># slopes_exp_liahovden was produced with flux_fitting</span></span>
<span>  ambient_conc <span class="op">=</span> <span class="fl">421</span>,</span>
<span>  error <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>  slope_col <span class="op">=</span> <span class="st">"f_slope"</span>,</span>
<span>  force_discard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  force_ok <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ratio_threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pvalue_col <span class="op">=</span> <span class="st">"f_pvalue"</span>,</span>
<span>  rsquared_col <span class="op">=</span> <span class="st">"f_rsquared"</span>,</span>
<span>  pvalue_threshold <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  rsquared_threshold <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"f_conc"</span>,</span>
<span>  time_col <span class="op">=</span> <span class="st">"f_time"</span>,</span>
<span>  fit_col <span class="op">=</span> <span class="st">"f_fit"</span>,</span>
<span>  cut_col <span class="op">=</span> <span class="st">"f_cut"</span>,</span>
<span>  cut_arg <span class="op">=</span> <span class="st">"cut"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total number of measurements: 138</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  discard      1   1 %</span></span>
<span><span class="co">#&gt;  ok   86      62 %</span></span>
<span><span class="co">#&gt;  zero     51      37 %</span></span>
<span><span class="co">#&gt;  weird_flux   0   0 %</span></span>
<span><span class="co">#&gt;  start_error      0   0 %</span></span>
<span><span class="co">#&gt;  no_data      0   0 %</span></span>
<span><span class="co">#&gt;  force_ok     0   0 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">slopes_qua_liahovden_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 30] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime    : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air      : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc        : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start       : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end         : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc      : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio       : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match  : chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_time        : num [1:30281] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ f_cut         : Factor w/ 1 level "keep": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ n_conc        : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_rsquared    : num [1:30281] 0.967 0.967 0.967 0.967 0.967 ...</span></span>
<span><span class="co">#&gt;  $ f_adj_rsquared: num [1:30281] 0.966 0.966 0.966 0.966 0.966 ...</span></span>
<span><span class="co">#&gt;  $ f_pvalue      : Named num [1:30281] 9.07e-161 9.07e-161 9.07e-161 9.07e-161 9.07e-161 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:30281] "value" "value" "value" "value" ...</span></span>
<span><span class="co">#&gt;  $ f_intercept   : num [1:30281] 465 465 465 465 465 ...</span></span>
<span><span class="co">#&gt;  $ f_param1      : num [1:30281] -0.11 -0.11 -0.11 -0.11 -0.11 ...</span></span>
<span><span class="co">#&gt;  $ f_param2      : num [1:30281] 3.9e-06 3.9e-06 3.9e-06 3.9e-06 3.9e-06 ...</span></span>
<span><span class="co">#&gt;  $ f_slope       : num [1:30281] -0.11 -0.11 -0.11 -0.11 -0.11 ...</span></span>
<span><span class="co">#&gt;  $ f_fit         : num [1:30281] 465 465 464 464 464 ...</span></span>
<span><span class="co">#&gt;  $ f_fit_slope   : num [1:30281] 465 465 464 464 464 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_ratio  : chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_start_error : chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_quality_flag: chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_slope_corr  : num [1:30281] -0.11 -0.11 -0.11 -0.11 -0.11 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "fit_type")= chr "quadratic"</span></span>
<span></span>
<span><span class="va">slopes_lin_liahovden_flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flux_quality.html">flux_quality</a></span><span class="op">(</span></span>
<span>  slopes_df <span class="op">=</span> <span class="va">slopes_lin_liahovden</span>,</span>
<span>  <span class="co"># fit_type is automatically provided as an attribute because</span></span>
<span>  <span class="co"># slopes_exp_liahovden was produced with flux_fitting</span></span>
<span>  ambient_conc <span class="op">=</span> <span class="fl">421</span>,</span>
<span>  error <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>  slope_col <span class="op">=</span> <span class="st">"f_slope"</span>,</span>
<span>  force_discard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  force_ok <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ratio_threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pvalue_col <span class="op">=</span> <span class="st">"f_pvalue"</span>,</span>
<span>  rsquared_col <span class="op">=</span> <span class="st">"f_rsquared"</span>,</span>
<span>  pvalue_threshold <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  rsquared_threshold <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  conc_col <span class="op">=</span> <span class="st">"f_conc"</span>,</span>
<span>  time_col <span class="op">=</span> <span class="st">"f_time"</span>,</span>
<span>  fit_col <span class="op">=</span> <span class="st">"f_fit"</span>,</span>
<span>  cut_col <span class="op">=</span> <span class="st">"f_cut"</span>,</span>
<span>  cut_arg <span class="op">=</span> <span class="st">"cut"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total number of measurements: 138</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  discard      6   4 %</span></span>
<span><span class="co">#&gt;  ok   52      38 %</span></span>
<span><span class="co">#&gt;  zero     80      58 %</span></span>
<span><span class="co">#&gt;  weird_flux   0   0 %</span></span>
<span><span class="co">#&gt;  start_error      0   0 %</span></span>
<span><span class="co">#&gt;  no_data      0   0 %</span></span>
<span><span class="co">#&gt;  force_ok     0   0 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">slopes_lin_liahovden_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,281 × 27] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ f_datetime    : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:31" ...</span></span>
<span><span class="co">#&gt;  $ temp_air      : num [1:30281] NA NA NA NA NA NA NA NA NA 3 ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:30281] NA NA NA NA NA NA NA NA NA 6.83 ...</span></span>
<span><span class="co">#&gt;  $ f_conc        : num [1:30281] 468 467 467 467 467 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:30281] NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:30281] "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:30281] "NEE" "NEE" "NEE" "NEE" ...</span></span>
<span><span class="co">#&gt;  $ f_start       : POSIXct[1:30281], format: "2022-07-27 05:37:30" "2022-07-27 05:37:30" ...</span></span>
<span><span class="co">#&gt;  $ f_end         : POSIXct[1:30281], format: "2022-07-27 05:41:10" "2022-07-27 05:41:10" ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_n_conc      : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_ratio       : num [1:30281] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_match  : chr [1:30281] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ f_time        : num [1:30281] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ f_cut         : Factor w/ 1 level "keep": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ n_conc        : int [1:30281] 220 220 220 220 220 220 220 220 220 220 ...</span></span>
<span><span class="co">#&gt;  $ f_rsquared    : num [1:30281] 0.967 0.967 0.967 0.967 0.967 ...</span></span>
<span><span class="co">#&gt;  $ f_adj_rsquared: num [1:30281] 0.966 0.966 0.966 0.966 0.966 ...</span></span>
<span><span class="co">#&gt;  $ f_pvalue      : Named num [1:30281] 9.23e-163 9.23e-163 9.23e-163 9.23e-163 9.23e-163 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:30281] "value" "value" "value" "value" ...</span></span>
<span><span class="co">#&gt;  $ f_intercept   : num [1:30281] 465 465 465 465 465 ...</span></span>
<span><span class="co">#&gt;  $ f_slope       : num [1:30281] -0.109 -0.109 -0.109 -0.109 -0.109 ...</span></span>
<span><span class="co">#&gt;  $ f_fit         : num [1:30281] 465 465 464 464 464 ...</span></span>
<span><span class="co">#&gt;  $ f_flag_ratio  : chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_start_error : chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_quality_flag: chr [1:30281] "ok" "ok" "ok" "ok" ...</span></span>
<span><span class="co">#&gt;  $ f_slope_corr  : num [1:30281] -0.109 -0.109 -0.109 -0.109 -0.109 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "fit_type")= chr "linear"</span></span></code></pre></div>
<p>The function <code>flux_plot</code> provides plots for a visual
assessment of the measurements, explicitly displaying the quality flags
from <code>flux_quality</code> and the cuts from
<code>flux_fitting</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes_exp_liahovden_flag</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we just show a sample of the plots to avoid slowing down the example</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f_fluxID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">54</span>, <span class="fl">95</span>, <span class="fl">100</span>, <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_plot.html">flux_plot</a></span><span class="op">(</span></span>
<span>    color_discard <span class="op">=</span> <span class="st">"#D55E00"</span>,</span>
<span>    color_cut <span class="op">=</span> <span class="st">"#D55E00"</span>,</span>
<span>    color_ok <span class="op">=</span> <span class="st">"#009E73"</span>,</span>
<span>    color_zero <span class="op">=</span> <span class="st">"#CC79A7"</span>,</span>
<span>    f_date_breaks <span class="op">=</span> <span class="st">"1 min"</span>,</span>
<span>    f_minor_breaks <span class="op">=</span> <span class="st">"10 sec"</span>,</span>
<span>    f_date_labels <span class="op">=</span> <span class="st">"%e/%m \n %H:%M"</span>,</span>
<span>    f_ylim_upper <span class="op">=</span> <span class="fl">600</span>,</span>
<span>    f_ylim_lower <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    f_plotname <span class="op">=</span> <span class="st">"plot_quality"</span>,</span>
<span>    facet_wrap_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    y_text_position <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    print_plot <span class="op">=</span> <span class="st">"FALSE"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"print_only"</span>,</span>
<span>    cut_arg <span class="op">=</span> <span class="st">"cut"</span>,</span>
<span>    no_data_flag <span class="op">=</span> <span class="st">"no_data"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Part of the fit will not be displayed</span></span>
<span><span class="co">#&gt;     because f_ylim_upper is too low.</span></span>
<span><span class="co">#&gt; Part of the fit will not be displayed</span></span>
<span><span class="co">#&gt;     because f_ylim_lower is too high.</span></span>
<span><span class="co">#&gt; Plotting in progress</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/plot_exp_qua_lin-1.png" width="768"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">slopes_qua_liahovden_flag</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we just show a sample of the plots to avoid slowing down the example</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f_fluxID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">54</span>, <span class="fl">95</span>, <span class="fl">100</span>, <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_plot.html">flux_plot</a></span><span class="op">(</span></span>
<span>    color_discard <span class="op">=</span> <span class="st">"#D55E00"</span>,</span>
<span>    color_cut <span class="op">=</span> <span class="st">"#D55E00"</span>,</span>
<span>    color_ok <span class="op">=</span> <span class="st">"#009E73"</span>,</span>
<span>    color_zero <span class="op">=</span> <span class="st">"#CC79A7"</span>,</span>
<span>    f_date_breaks <span class="op">=</span> <span class="st">"1 min"</span>,</span>
<span>    f_minor_breaks <span class="op">=</span> <span class="st">"10 sec"</span>,</span>
<span>    f_date_labels <span class="op">=</span> <span class="st">"%e/%m \n %H:%M"</span>,</span>
<span>    f_ylim_upper <span class="op">=</span> <span class="fl">600</span>,</span>
<span>    f_ylim_lower <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    f_plotname <span class="op">=</span> <span class="st">"plot_quality"</span>,</span>
<span>    facet_wrap_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    y_text_position <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    print_plot <span class="op">=</span> <span class="st">"FALSE"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"print_only"</span>,</span>
<span>    cut_arg <span class="op">=</span> <span class="st">"cut"</span>,</span>
<span>    no_data_flag <span class="op">=</span> <span class="st">"no_data"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Plotting in progress</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/plot_exp_qua_lin-2.png" width="768"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">slopes_lin_liahovden_flag</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we just show a sample of the plots to avoid slowing down the example</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f_fluxID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">54</span>, <span class="fl">95</span>, <span class="fl">100</span>, <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_plot.html">flux_plot</a></span><span class="op">(</span></span>
<span>    color_discard <span class="op">=</span> <span class="st">"#D55E00"</span>,</span>
<span>    color_cut <span class="op">=</span> <span class="st">"#D55E00"</span>,</span>
<span>    color_ok <span class="op">=</span> <span class="st">"#009E73"</span>,</span>
<span>    color_zero <span class="op">=</span> <span class="st">"#CC79A7"</span>,</span>
<span>    f_date_breaks <span class="op">=</span> <span class="st">"1 min"</span>,</span>
<span>    f_minor_breaks <span class="op">=</span> <span class="st">"10 sec"</span>,</span>
<span>    f_date_labels <span class="op">=</span> <span class="st">"%e/%m \n %H:%M"</span>,</span>
<span>    f_ylim_upper <span class="op">=</span> <span class="fl">600</span>,</span>
<span>    f_ylim_lower <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    f_plotname <span class="op">=</span> <span class="st">"plot_quality"</span>,</span>
<span>    facet_wrap_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    y_text_position <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    print_plot <span class="op">=</span> <span class="st">"FALSE"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"print_only"</span>,</span>
<span>    cut_arg <span class="op">=</span> <span class="st">"cut"</span>,</span>
<span>    no_data_flag <span class="op">=</span> <span class="st">"no_data"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Plotting in progress</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/plot_exp_qua_lin-3.png" width="768"></p>
<p>Based on the quality flags and the plots, the user can decide to run
<code>flux_fitting</code> again with different arguments. Here we will
do it while cutting the last 60 seconds of the fluxes (cutting the last
third). We also detected fluxes that do not look correct. Sometimes some
measurements will pass the automated quality control but are obviously
wrong for an experience user. That is what the
<code>weird_fluxesID</code> argument is for. For the sake of
reproducibility, this argument should be the last option and be
accompanied with a justification.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes_exp_liahovden_flag_60</span> <span class="op">&lt;-</span> <span class="va">conc_liahovden</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_fitting.html">flux_fitting</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="st">"exp"</span>, end_cut <span class="op">=</span> <span class="fl">60</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_quality.html">flux_quality</a></span><span class="op">(</span></span>
<span>    slope_col <span class="op">=</span> <span class="st">"f_slope"</span>,</span>
<span>    force_discard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">51</span>, <span class="co"># slope is much steeper than the flux because t zero was estimated</span></span>
<span>      <span class="co"># at the very start of the measurement</span></span>
<span>      <span class="fl">101</span>, <span class="co"># plot starts with a high peak: accumulation in the canopy?</span></span>
<span>      <span class="fl">106</span> <span class="co"># peak at the beginning of the flux that is messing up the fit</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Cutting measurements...</span></span>
<span><span class="co">#&gt; Estimating starting parameters for optimization...</span></span>
<span><span class="co">#&gt; Optimizing fitting parameters...</span></span>
<span><span class="co">#&gt; Calculating fits and slopes...</span></span>
<span><span class="co">#&gt; Done.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total number of measurements: 135</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  discard      1   1 %</span></span>
<span><span class="co">#&gt;  ok   131     97 %</span></span>
<span><span class="co">#&gt;  zero     3   2 %</span></span>
<span><span class="co">#&gt;  weird_flux   0   0 %</span></span>
<span><span class="co">#&gt;  start_error      0   0 %</span></span>
<span><span class="co">#&gt;  no_data      0   0 %</span></span>
<span><span class="co">#&gt;  force_ok     0   0 %</span></span>
<span></span>
<span><span class="va">slopes_exp_liahovden_flag_60</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we just show a sample of the plots to avoid slowing down the example</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f_fluxID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">54</span>, <span class="fl">95</span>, <span class="fl">100</span>, <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_plot.html">flux_plot</a></span><span class="op">(</span></span>
<span>    f_ylim_lower <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    f_ylim_upper <span class="op">=</span> <span class="fl">600</span>,</span>
<span>    facet_wrap_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    y_text_position <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"print_only"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Part of the fit will not be displayed</span></span>
<span><span class="co">#&gt;     because f_ylim_lower is too high.</span></span>
<span><span class="co">#&gt; Plotting in progress</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/plot_exp_cut-1.png" width="768"></p>
<p>We also apply a cut on the dataset that was fitted with a quadratic
model. At this point it is up to the user to decide which model works
the best for the entire dataset. The function flux_quality provides a
count of the quality flags that can help to take a decision.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes_qua_liahovden_flag_60</span> <span class="op">&lt;-</span> <span class="va">conc_liahovden</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_fitting.html">flux_fitting</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="st">"qua"</span>, end_cut <span class="op">=</span> <span class="fl">60</span>, t_zero <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_quality.html">flux_quality</a></span><span class="op">(</span></span>
<span>    slope_col <span class="op">=</span> <span class="st">"f_slope"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total number of measurements: 138</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ok   121     88 %</span></span>
<span><span class="co">#&gt;  zero     17      12 %</span></span>
<span><span class="co">#&gt;  discard      0   0 %</span></span>
<span><span class="co">#&gt;  weird_flux   0   0 %</span></span>
<span><span class="co">#&gt;  start_error      0   0 %</span></span>
<span><span class="co">#&gt;  no_data      0   0 %</span></span>
<span><span class="co">#&gt;  force_ok     0   0 %</span></span>
<span></span>
<span><span class="va">slopes_qua_liahovden_flag_60</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we just show a sample of the plots to avoid slowing down the example</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f_fluxID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">54</span>, <span class="fl">95</span>, <span class="fl">100</span>, <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_plot.html">flux_plot</a></span><span class="op">(</span></span>
<span>    f_ylim_lower <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    f_ylim_upper <span class="op">=</span> <span class="fl">600</span>,</span>
<span>    facet_wrap_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    y_text_position <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"print_only"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Plotting in progress</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/plot_qua_cut-1.png" width="768"></p>
<p>When using a linear fit it is common to take only a short section of
the measurement close to the start. Here we will cut 120 seconds at the
end, effectively keeping only the first 90 seconds.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes_lin_liahovden_flag_120</span> <span class="op">&lt;-</span> <span class="va">conc_liahovden</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_fitting.html">flux_fitting</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="st">"lin"</span>, end_cut <span class="op">=</span> <span class="fl">120</span>, t_zero <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_quality.html">flux_quality</a></span><span class="op">(</span></span>
<span>    slope_col <span class="op">=</span> <span class="st">"f_slope"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total number of measurements: 138</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  discard      2   1 %</span></span>
<span><span class="co">#&gt;  ok   109     79 %</span></span>
<span><span class="co">#&gt;  zero     27      20 %</span></span>
<span><span class="co">#&gt;  weird_flux   0   0 %</span></span>
<span><span class="co">#&gt;  start_error      0   0 %</span></span>
<span><span class="co">#&gt;  no_data      0   0 %</span></span>
<span><span class="co">#&gt;  force_ok     0   0 %</span></span>
<span></span>
<span><span class="va">slopes_lin_liahovden_flag_120</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we just show a sample of the plots to avoid slowing down the example</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f_fluxID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">54</span>, <span class="fl">95</span>, <span class="fl">100</span>, <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_plot.html">flux_plot</a></span><span class="op">(</span></span>
<span>    f_ylim_lower <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    f_ylim_upper <span class="op">=</span> <span class="fl">600</span>,</span>
<span>    facet_wrap_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    y_text_position <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"print_only"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Plotting in progress</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/plot_lin_cut-1.png" width="768"></p>
<p>Once we are satisfied with the fit, we can calculate fluxes with
<code>flux_calc</code>. Here the volume is defined as a constant for all
the measurements but it is also possible to provide a specific volume
for each plot in case that is different.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fluxes_exp_liahovden_60</span> <span class="op">&lt;-</span> <span class="va">slopes_exp_liahovden_flag_60</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_calc.html">flux_calc</a></span><span class="op">(</span></span>
<span>    slope_col <span class="op">=</span> <span class="st">"f_slope_corr"</span>, <span class="co"># we use the slopes provided by flux_quality</span></span>
<span>    datetime_col <span class="op">=</span> <span class="st">"f_datetime"</span>,</span>
<span>    conc_unit <span class="op">=</span> <span class="st">"ppm"</span>,</span>
<span>    flux_unit <span class="op">=</span> <span class="st">"mmol"</span>,</span>
<span>    cut_col <span class="op">=</span> <span class="st">"f_cut"</span>,</span>
<span>    keep_arg <span class="op">=</span> <span class="st">"keep"</span>,</span>
<span>    chamber_volume <span class="op">=</span> <span class="fl">24.5</span>,</span>
<span>    tube_volume <span class="op">=</span> <span class="fl">0.075</span>,</span>
<span>    atm_pressure <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    plot_area <span class="op">=</span> <span class="fl">0.0625</span>,</span>
<span>    cols_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"turfID"</span>, <span class="st">"type"</span>, <span class="st">"pairID"</span><span class="op">)</span>,</span>
<span>    cols_ave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_soil"</span>, <span class="st">"PAR"</span><span class="op">)</span>,</span>
<span>    fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>    temp_air_col <span class="op">=</span> <span class="st">"temp_air"</span>,</span>
<span>    temp_air_unit <span class="op">=</span> <span class="st">"celsius"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Cutting data according to 'keep_arg'...</span></span>
<span><span class="co">#&gt; Averaging air temperature for each flux...</span></span>
<span><span class="co">#&gt; Creating a df with the columns from 'cols_keep' argument...</span></span>
<span><span class="co">#&gt; Creating a df with the columns from 'cols_ave' argument...</span></span>
<span><span class="co">#&gt; Calculating fluxes...</span></span>
<span><span class="co">#&gt; R constant set to 0.082057</span></span>
<span><span class="co">#&gt; Concentration was measured in ppm</span></span>
<span><span class="co">#&gt; Fluxes are in mmol/m2/h</span></span>
<span></span>
<span><span class="va">fluxes_qua_liahovden_60</span> <span class="op">&lt;-</span> <span class="va">slopes_qua_liahovden_flag_60</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_calc.html">flux_calc</a></span><span class="op">(</span></span>
<span>    slope_col <span class="op">=</span> <span class="st">"f_slope_corr"</span>, <span class="co"># we use the slopes provided by flux_quality</span></span>
<span>    datetime_col <span class="op">=</span> <span class="st">"f_datetime"</span>,</span>
<span>    conc_unit <span class="op">=</span> <span class="st">"ppm"</span>,</span>
<span>    flux_unit <span class="op">=</span> <span class="st">"mmol"</span>,</span>
<span>    cut_col <span class="op">=</span> <span class="st">"f_cut"</span>,</span>
<span>    keep_arg <span class="op">=</span> <span class="st">"keep"</span>,</span>
<span>    chamber_volume <span class="op">=</span> <span class="fl">24.5</span>,</span>
<span>    tube_volume <span class="op">=</span> <span class="fl">0.075</span>,</span>
<span>    atm_pressure <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    plot_area <span class="op">=</span> <span class="fl">0.0625</span>,</span>
<span>    cols_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"turfID"</span>, <span class="st">"type"</span>, <span class="st">"pairID"</span><span class="op">)</span>,</span>
<span>    cols_ave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_soil"</span>, <span class="st">"PAR"</span><span class="op">)</span>,</span>
<span>    fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>    temp_air_col <span class="op">=</span> <span class="st">"temp_air"</span>,</span>
<span>    temp_air_unit <span class="op">=</span> <span class="st">"celsius"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Cutting data according to 'keep_arg'...</span></span>
<span><span class="co">#&gt; Averaging air temperature for each flux...</span></span>
<span><span class="co">#&gt; Creating a df with the columns from 'cols_keep' argument...</span></span>
<span><span class="co">#&gt; Creating a df with the columns from 'cols_ave' argument...</span></span>
<span><span class="co">#&gt; Calculating fluxes...</span></span>
<span><span class="co">#&gt; R constant set to 0.082057</span></span>
<span><span class="co">#&gt; Concentration was measured in ppm</span></span>
<span><span class="co">#&gt; Fluxes are in mmol/m2/h</span></span>
<span></span>
<span><span class="va">fluxes_lin_liahovden_120</span> <span class="op">&lt;-</span> <span class="va">slopes_lin_liahovden_flag_120</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_calc.html">flux_calc</a></span><span class="op">(</span></span>
<span>    slope_col <span class="op">=</span> <span class="st">"f_slope_corr"</span>, <span class="co"># we use the slopes provided by flux_quality</span></span>
<span>    datetime_col <span class="op">=</span> <span class="st">"f_datetime"</span>,</span>
<span>    conc_unit <span class="op">=</span> <span class="st">"ppm"</span>,</span>
<span>    flux_unit <span class="op">=</span> <span class="st">"mmol"</span>,</span>
<span>    cut_col <span class="op">=</span> <span class="st">"f_cut"</span>,</span>
<span>    keep_arg <span class="op">=</span> <span class="st">"keep"</span>,</span>
<span>    chamber_volume <span class="op">=</span> <span class="fl">24.5</span>,</span>
<span>    tube_volume <span class="op">=</span> <span class="fl">0.075</span>,</span>
<span>    atm_pressure <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    plot_area <span class="op">=</span> <span class="fl">0.0625</span>,</span>
<span>    cols_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"turfID"</span>, <span class="st">"type"</span>, <span class="st">"pairID"</span><span class="op">)</span>,</span>
<span>    cols_ave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_soil"</span>, <span class="st">"PAR"</span><span class="op">)</span>,</span>
<span>    fluxid_col <span class="op">=</span> <span class="st">"f_fluxID"</span>,</span>
<span>    temp_air_col <span class="op">=</span> <span class="st">"temp_air"</span>,</span>
<span>    temp_air_unit <span class="op">=</span> <span class="st">"celsius"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Cutting data according to 'keep_arg'...</span></span>
<span><span class="co">#&gt; Averaging air temperature for each flux...</span></span>
<span><span class="co">#&gt; Creating a df with the columns from 'cols_keep' argument...</span></span>
<span><span class="co">#&gt; Creating a df with the columns from 'cols_ave' argument...</span></span>
<span><span class="co">#&gt; Calculating fluxes...</span></span>
<span><span class="co">#&gt; R constant set to 0.082057</span></span>
<span><span class="co">#&gt; Concentration was measured in ppm</span></span>
<span><span class="co">#&gt; Fluxes are in mmol/m2/h</span></span></code></pre></div>
<p>The output is in mmol/m<sup>2</sup>/h and the calculation used is as
follow:</p>
<!-- <img src="https://render.githubusercontent.com/render/math?math=flux=slope\times \frac{P\times V}{R\times T\times A}"> -->
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">flux</mtext><mo>=</mo><mtext mathvariant="normal">slope</mtext><mo>×</mo><mfrac><mrow><mi>P</mi><mo>×</mo><mi>V</mi></mrow><mrow><mi>R</mi><mo>×</mo><mi>T</mi><mo>×</mo><mi>A</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
 \text{flux}=\text{slope}\times \frac{P\times V}{R\times T\times A}
</annotation></semantics></math></p>
<p>where</p>
<p>flux: the flux of gas at the surface of the plot
(mmol/m<sup>2</sup>/h)</p>
<p>slope: slope estimate (ppm*s<sup>-1</sup>)</p>
<p>P: pressure, assumed (atm)</p>
<p>V: volume of the chamber and tubing (L)</p>
<p>R: gas constant (0.082057 L*atm*K<sup>-1</sup>*mol<sup>-1</sup>)</p>
<p>T: chamber air temperature (K)</p>
<p>A: area of chamber frame base (m<sup>2</sup>)</p>
<p>The conversion from micromol/m<sup>2</sup>/s to mmol/m<sup>2</sup>/h
is included in the function.</p>
<p>Fluxes were calculated in five steps from raw gas concentration data
and the process is entirely reproducible.</p>
<p>Next we can calculated gross ecosystem production (GEP) and plot the
results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fluxes_exp_liahovden_60_gep</span> <span class="op">&lt;-</span> <span class="va">fluxes_exp_liahovden_60</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_gep.html">flux_gep</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="st">"pairID"</span>,</span>
<span>    flux_col <span class="op">=</span> <span class="st">"flux"</span>,</span>
<span>    type_col <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>    datetime_col <span class="op">=</span> <span class="st">"datetime"</span>,</span>
<span>    par_col <span class="op">=</span> <span class="st">"PAR"</span>,</span>
<span>    cols_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_soil"</span>, <span class="st">"model"</span>, <span class="st">"turfID"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fluxes_exp_liahovden_60_gep</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [207 × 16] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ datetime      : POSIXct[1:207], format: "2022-07-27 05:37:30" "2022-07-27 05:46:55" ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:207] 24.2 28.8 48.1 161.5 121.4 ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:207] "GEP" "GEP" "GEP" "GEP" ...</span></span>
<span><span class="co">#&gt;  $ flux          : num [1:207] -18.57 -38.42 -20.18 -5.9 -6.99 ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:207] 6.96 6.83 2.5 6.99 6.7 ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:207] "4 AN1C 4" "27 AN3C 27" "77 AN2C 77" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ f_slope_calc  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ chamber_volume: num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ tube_volume   : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ atm_pressure  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ plot_area     : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_air_ave  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ volume_setup  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ model         : chr [1:207] "exponential" "exponential" "exponential" "exponential" ...</span></span>
<span></span>
<span><span class="va">fluxes_qua_liahovden_60_gep</span> <span class="op">&lt;-</span> <span class="va">fluxes_qua_liahovden_60</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_gep.html">flux_gep</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="st">"pairID"</span>,</span>
<span>    flux_col <span class="op">=</span> <span class="st">"flux"</span>,</span>
<span>    type_col <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>    datetime_col <span class="op">=</span> <span class="st">"datetime"</span>,</span>
<span>    par_col <span class="op">=</span> <span class="st">"PAR"</span>,</span>
<span>    cols_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_soil"</span>, <span class="st">"model"</span>, <span class="st">"turfID"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fluxes_qua_liahovden_60_gep</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [207 × 16] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ datetime      : POSIXct[1:207], format: "2022-07-27 05:37:30" "2022-07-27 05:46:55" ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:207] 24.2 28.8 48.1 161.5 121.4 ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:207] "GEP" "GEP" "GEP" "GEP" ...</span></span>
<span><span class="co">#&gt;  $ flux          : num [1:207] -13.53 -32.5 -10.35 -6.55 -6.79 ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:207] 6.96 6.83 2.5 6.99 6.7 ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:207] "4 AN1C 4" "27 AN3C 27" "77 AN2C 77" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ f_slope_calc  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ chamber_volume: num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ tube_volume   : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ atm_pressure  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ plot_area     : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_air_ave  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ volume_setup  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ model         : chr [1:207] "quadratic" "quadratic" "quadratic" "quadratic" ...</span></span>
<span></span>
<span><span class="va">fluxes_lin_liahovden_120_gep</span> <span class="op">&lt;-</span> <span class="va">fluxes_lin_liahovden_120</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/flux_gep.html">flux_gep</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="st">"pairID"</span>,</span>
<span>    flux_col <span class="op">=</span> <span class="st">"flux"</span>,</span>
<span>    type_col <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>    datetime_col <span class="op">=</span> <span class="st">"datetime"</span>,</span>
<span>    par_col <span class="op">=</span> <span class="st">"PAR"</span>,</span>
<span>    cols_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_soil"</span>, <span class="st">"model"</span>, <span class="st">"turfID"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fluxes_lin_liahovden_120_gep</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [207 × 16] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ datetime      : POSIXct[1:207], format: "2022-07-27 05:37:30" "2022-07-27 05:46:55" ...</span></span>
<span><span class="co">#&gt;  $ pairID        : Factor w/ 69 levels "1","3","5","7",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ PAR           : num [1:207] 23 28.2 46 164.4 120.5 ...</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:207] "GEP" "GEP" "GEP" "GEP" ...</span></span>
<span><span class="co">#&gt;  $ flux          : num [1:207] -10.02 -20.55 0 -3.29 -6.24 ...</span></span>
<span><span class="co">#&gt;  $ f_fluxID      : Factor w/ 138 levels "1","2","3","4",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_soil     : num [1:207] 6.93 6.82 2.55 7 6.68 ...</span></span>
<span><span class="co">#&gt;  $ turfID        : chr [1:207] "4 AN1C 4" "27 AN3C 27" "77 AN2C 77" "4 AN1C 4" ...</span></span>
<span><span class="co">#&gt;  $ f_slope_calc  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ chamber_volume: num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ tube_volume   : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ atm_pressure  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ plot_area     : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_air_ave  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ volume_setup  : num [1:207] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ model         : chr [1:207] "linear" "linear" "linear" "linear" ...</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">fluxes_exp_liahovden_60_gep</span>,</span>
<span>  <span class="va">fluxes_qua_liahovden_60_gep</span>,</span>
<span>  <span class="va">fluxes_lin_liahovden_120_gep</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">datetime</span>, y <span class="op">=</span> <span class="va">flux</span>, color <span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Net Ecosystem Exchange at Upper Site (Liahovden) during 24 hour"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Datetime"</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="op">~</span> <span class="va">CO</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="st">"flux [mmol/"</span> <span class="op">*</span> <span class="va">m</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="st">"/h]"</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Model used in flux_fitting"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fluxible_practical_example_files/figure-html/24h_fluxes-1.png" width="768"></p>
<div class="section level4 unnumbered">
<h4 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h4>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-zhaoCalculationDaytimeCO22018" class="csl-entry">
Zhao, P., Hammerle, A., Zeeman, M. and Wohlfahrt, G. (2018), <span>“<a href="https://doi.org/10.1016/j.agrformet.2018.08.022" class="external-link">On the
calculation of daytime <span>CO2</span> fluxes measured by automated
closed transparent chambers</a>”</span>, <em>Agricultural and Forest
Meteorology</em>, Vol. 263, pp. 267–275.
</div>
</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joseph Gaudard, Jonas Trepel, Hilary Rose Dawson, Michael Mustri, Pekka O Niittynen, Paul Efren Santos-Andrade, Richard James Telford.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
